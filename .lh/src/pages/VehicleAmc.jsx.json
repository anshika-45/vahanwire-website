{
    "sourceFile": "src/pages/VehicleAmc.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1763039763930,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1763039763930,
            "name": "Commit-0",
            "content": "import React, { useState, Suspense, useEffect } from \"react\";\r\nimport AMC from \"../components/AMC\";\r\nimport { useAmcData } from \"../context/AmcDataContext\";\r\nimport { useAuth } from \"../context/AuthContext\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport AMCCards from \"../components/AmcCard\";\r\nimport BreadcrumbBar from \"../components/BreadcrumbBar\";\r\nimport { getUserVehicles } from \"../api/vehicleApi\";\r\nconst AmcTabs = React.lazy(() => import(\"../components/AmcTabs\"));\r\nconst AmcCard = React.lazy(() => import(\"../components/AmcCard\"));\r\nconst CompareTable = React.lazy(() => import(\"../components/CompareTable\"));\r\nconst LatestOffer = React.lazy(() => import(\"../components/LatestOffer\"));\r\nconst AmcBanner = React.lazy(() => import(\"../components/AmcBanner\"));\r\nconst AddBanner = React.lazy(() => import(\"../components/AddBanner\"));\r\nconst VerifyNumberPopup = React.lazy(() =>\r\n  import(\"../popup/VerifyNumberPopup\")\r\n);\r\nconst EnterVehicleNumber = React.lazy(() =>\r\n  import(\"../popup/EnterVehicleNumber\")\r\n);\r\nconst SelectVehicle = React.lazy(() => import(\"../popup/SelectVehicle\"));\r\nconst CardLoader = () => (\r\n  <div className=\"h-64 bg-gray-200 animate-pulse rounded-lg\"></div>\r\n);\r\nconst TableLoader = () => (\r\n  <div className=\"h-96 bg-gray-200 animate-pulse rounded-lg\"></div>\r\n);\r\nconst BannerLoader = () => (\r\n  <div className=\"h-48 bg-gray-200 animate-pulse rounded-lg\"></div>\r\n);\r\nconst ComponentLoader = () => (\r\n  <div className=\"flex justify-center items-center py-8\">\r\n    <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-[#266DDF]\"></div>\r\n  </div>\r\n);\r\n\r\nconst VehicleAmc = () => {\r\n  const { features, vehicleType, setVehicleType, filterActive, filterData, clearFilter } =\r\n    useAmcData();\r\n  const { isLoggedIn } = useAuth();\r\n  const navigate = useNavigate();\r\n  const [isVerifyOpen, setIsVerifyOpen] = useState(false);\r\n  const [isVehicleOpen, setIsVehicleOpen] = useState(false);\r\n  const [isSelectVehicleOpen, setIsSelectVehicleOpen] = useState(false);\r\n  const [selectedPlan, setSelectedPlan] = useState(null);\r\n\r\n  useEffect(() => {\r\n    const checkFilterValidity = async () => {\r\n      if (filterActive && filterData) {\r\n        // Check if the selected vehicle still exists\r\n        const vehicles = await getUserVehicles();\r\n        const vehicleExists = vehicles.some(\r\n          v => v.vehicleNumber === filterData.vehicle?.vehicleNumber\r\n        );\r\n        \r\n        if (vehicleExists) {\r\n          // Vehicle exists, navigate to filter page\r\n          navigate(\"/vehicle-amc-filter\", {\r\n            state: filterData,\r\n            replace: true,\r\n          });\r\n        } else {\r\n          // Vehicle was deleted, clear the filter\r\n          clearFilter();\r\n        }\r\n      }\r\n    };\r\n    \r\n    checkFilterValidity();\r\n  }, [filterActive, filterData, navigate]);\r\n\r\n  const checkUserVehicles = async () => {\r\n    try {\r\n      const vehicles = await getUserVehicles();\r\n      return vehicles && vehicles.length > 0;\r\n    } catch (error) {\r\n      console.error(\"Error checking vehicles:\", error);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const handleGenericBuy = async () => {\r\n    setSelectedPlan(null);\r\n    setIsVehicleOpen(false);\r\n    setIsSelectVehicleOpen(false);\r\n    \r\n    if (isLoggedIn) {\r\n      const hasVehicles = await checkUserVehicles();\r\n      if (hasVehicles) {\r\n        setIsVehicleOpen(false);\r\n        setIsSelectVehicleOpen(true);\r\n      } else {\r\n        setIsSelectVehicleOpen(false);\r\n        setIsVehicleOpen(true);\r\n      }\r\n    } else {\r\n      setIsVerifyOpen(true);\r\n    }\r\n  };\r\n\r\n  const handlePlanBuy = async (plan) => {\r\n    setSelectedPlan(plan);\r\n    setIsVehicleOpen(false);\r\n    setIsSelectVehicleOpen(false);\r\n    \r\n    if (isLoggedIn) {\r\n      const hasVehicles = await checkUserVehicles();\r\n      if (hasVehicles) {\r\n        setIsVehicleOpen(false);\r\n        setIsSelectVehicleOpen(true);\r\n      } else {\r\n        setIsSelectVehicleOpen(false);\r\n        setIsVehicleOpen(true);\r\n      }\r\n    } else {\r\n      setIsVerifyOpen(true);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <section className=\"w-full\">\r\n      <AMC vehicleType={vehicleType} setVehicleType={setVehicleType} />\r\n\r\n      <div className=\"container space-y-8 sm:space-y-10 mb-12\">\r\n        <Suspense fallback={<ComponentLoader />}>\r\n          <AmcTabs />\r\n        </Suspense>\r\n      </div>\r\n\r\n      <Suspense fallback={<CardLoader />}>\r\n        <AMCCards onBuy={handlePlanBuy} />\r\n      </Suspense>\r\n      <Suspense fallback={<TableLoader />}>\r\n        <CompareTable features={features} onBuy={handlePlanBuy} />\r\n      </Suspense>\r\n      {/* <Suspense fallback={<BannerLoader />}>\r\n        <LatestOffer />\r\n      </Suspense>\r\n\r\n      <div className=\"flex flex-col lg:flex-col gap-6\">\r\n        <Suspense fallback={<BannerLoader />}>\r\n          <AmcBanner onBuy={handleGenericBuy} />\r\n        </Suspense>\r\n      </div> */}\r\n      <Suspense fallback={null}>\r\n        <VerifyNumberPopup\r\n          isOpen={isVerifyOpen}\r\n          onClose={() => setIsVerifyOpen(false)}\r\n        />\r\n      </Suspense>\r\n      <Suspense fallback={null}>\r\n        <EnterVehicleNumber\r\n          isOpen={isVehicleOpen}\r\n          onClose={() => setIsVehicleOpen(false)}\r\n          plan={selectedPlan}\r\n          onBack={()=>setIsVehicleOpen(false)}\r\n        />\r\n      </Suspense>\r\n      <Suspense fallback={null}>\r\n        <SelectVehicle\r\n          isOpen={isSelectVehicleOpen}\r\n          onClose={() => setIsSelectVehicleOpen(false)}\r\n          plan={selectedPlan}\r\n        />\r\n      </Suspense>\r\n    </section>\r\n  );\r\n};\r\n\r\nexport default VehicleAmc;\r\n"
        }
    ]
}