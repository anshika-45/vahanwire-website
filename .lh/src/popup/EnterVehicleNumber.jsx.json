{
    "sourceFile": "src/popup/EnterVehicleNumber.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1763038323812,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763038330650,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,10 +23,9 @@\n \r\n   const validateVehicleNumber = (number) => {\r\n     const cleanedNumber = number.trim().toUpperCase().replace(/[-\\s]/g, \"\");\r\n \r\n-    // Common India vehicle number format: MH12AB1234\r\n-    // State Code (2 letters) + RTO (1–2 digits) + Series (1–3 letters) + Number (1–4 digits)\r\n+  \r\n     const indianVehicleRegex = /^[A-Z]{2}[0-9]{1,2}[A-Z]{1,3}[0-9]{1,4}$/;\r\n \r\n     // Some older vehicles or temporary numbers have different pattern (like DL3S1234, BR01T999)\r\n     const alternateRegex = /^[A-Z]{2}[0-9]{1,2}[A-Z]{1}[0-9]{3,4}$/;\r\n"
                },
                {
                    "date": 1763038339231,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,12 +23,10 @@\n \r\n   const validateVehicleNumber = (number) => {\r\n     const cleanedNumber = number.trim().toUpperCase().replace(/[-\\s]/g, \"\");\r\n \r\n-  \r\n     const indianVehicleRegex = /^[A-Z]{2}[0-9]{1,2}[A-Z]{1,3}[0-9]{1,4}$/;\r\n \r\n-    // Some older vehicles or temporary numbers have different pattern (like DL3S1234, BR01T999)\r\n     const alternateRegex = /^[A-Z]{2}[0-9]{1,2}[A-Z]{1}[0-9]{3,4}$/;\r\n \r\n     if (cleanedNumber.length < 8 || cleanedNumber.length > 15) {\r\n       return {\r\n"
                }
            ],
            "date": 1763038323812,
            "name": "Commit-0",
            "content": "import React, { useState, Suspense } from \"react\";\r\nimport { useAmcData } from \"../context/AmcDataContext\";\r\nimport Button from \"../components/Button\";\r\nimport verifyIcon from \"../assets/verify.webp\";\r\nimport Modal from \"../components/Modal\";\r\nimport { searchUserVehicle, addUserVehicle } from \"../api/vehicleApi\";\r\nconst SelectVehicle = React.lazy(() => import(\"./SelectVehicle\"));\r\n\r\nconst EnterVehicleNumber = ({ isOpen, onClose, onBack, plan }) => {\r\n  const { vehicleType } = useAmcData();\r\n  const [vehicleNumber, setVehicleNumber] = useState(\"\");\r\n  const [vehicleModel, setVehicleModel] = useState(\"\");\r\n  const [brand, setBrand] = useState(\"\");\r\n  const [showSelectVehicle, setShowSelectVehicle] = useState(false);\r\n  const [numberError, setNumberError] = useState(\"\");\r\n  const [modelError, setModelError] = useState(\"\");\r\n  const [brandError, setBrandError] = useState(\"\");\r\n  const [showModel, setShowModel] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [vehicleData, setVehicleData] = useState(null);\r\n\r\n  if (!isOpen && !showSelectVehicle) return null;\r\n\r\n  const validateVehicleNumber = (number) => {\r\n    const cleanedNumber = number.trim().toUpperCase().replace(/[-\\s]/g, \"\");\r\n\r\n    // Common India vehicle number format: MH12AB1234\r\n    // State Code (2 letters) + RTO (1–2 digits) + Series (1–3 letters) + Number (1–4 digits)\r\n    const indianVehicleRegex = /^[A-Z]{2}[0-9]{1,2}[A-Z]{1,3}[0-9]{1,4}$/;\r\n\r\n    // Some older vehicles or temporary numbers have different pattern (like DL3S1234, BR01T999)\r\n    const alternateRegex = /^[A-Z]{2}[0-9]{1,2}[A-Z]{1}[0-9]{3,4}$/;\r\n\r\n    if (cleanedNumber.length < 8 || cleanedNumber.length > 15) {\r\n      return {\r\n        isValid: false,\r\n        message: \"Vehicle number should be between 8–15 characters\",\r\n      };\r\n    }\r\n\r\n    if (!indianVehicleRegex.test(cleanedNumber) && !alternateRegex.test(cleanedNumber)) {\r\n      return {\r\n        isValid: false,\r\n        message: \"Please enter a valid vehicle number (e.g., MH12AB1234 or DL3S9999)\",\r\n      };\r\n    }\r\n\r\n    return {\r\n      isValid: true,\r\n      message: \"\",\r\n      formattedNumber: cleanedNumber,\r\n    };\r\n  };\r\n\r\n  const verifyVehicleNumber = async (regNumber) => {\r\n    setIsLoading(true);\r\n    try {\r\n      const data = await searchUserVehicle(regNumber);\r\n      setIsLoading(false);\r\n      if ((data.found && data.vehicle) || (data.data?.found && data.data?.vehicle)) {\r\n        const vehicle = data.vehicle || data.data.vehicle;\r\n        return { found: true, vehicle };\r\n      } else {\r\n        return { found: false };\r\n      }\r\n    } catch (error) {\r\n      setIsLoading(false);\r\n      console.error(\"Error verifying vehicle:\", error);\r\n      return { found: false };\r\n    }\r\n  };\r\n\r\n  const handleSearch = async () => {\r\n    const validation = validateVehicleNumber(vehicleNumber);\r\n    if (!validation.isValid) {\r\n      setNumberError(validation.message);\r\n      return;\r\n    }\r\n    setNumberError(\"\");\r\n    const formattedNumber = validation.formattedNumber;\r\n    const result = await verifyVehicleNumber(formattedNumber);\r\n    if (result.found && result.vehicle) {\r\n      setVehicleData({\r\n        vehicleNumber: result.vehicle.vehicleNumber,\r\n        brand: result.vehicle.brand,\r\n        model: result.vehicle.model,\r\n      });\r\n      setShowSelectVehicle(true);\r\n    } else {\r\n      setShowModel(true);\r\n      setVehicleNumber(formattedNumber);\r\n    }\r\n  };\r\n\r\n  const handleAddVehicle = async () => {\r\n    let hasError = false;\r\n    if (!brand.trim()) {\r\n      setBrandError(\"Please enter the vehicle brand\");\r\n      hasError = true;\r\n    }\r\n    if (!vehicleModel.trim()) {\r\n      setModelError(\"Please enter the vehicle model\");\r\n      hasError = true;\r\n    }\r\n    if (hasError) return;\r\n\r\n    const validation = validateVehicleNumber(vehicleNumber);\r\n    if (!validation.isValid) {\r\n      setNumberError(validation.message);\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    const newVehicle = {\r\n      vehicleNumber: validation.formattedNumber,\r\n      brand: brand.trim(),\r\n      model: vehicleModel.trim(),\r\n    };\r\n\r\n    try {\r\n      const response = await addUserVehicle(newVehicle);\r\n      setIsLoading(false);\r\n      if (response.status === 201) {\r\n        setVehicleData(newVehicle);\r\n        setShowSelectVehicle(true);\r\n      }\r\n    } catch (error) {\r\n      setIsLoading(false);\r\n      console.error(\"Error adding vehicle:\", error);\r\n    }\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setVehicleNumber(\"\");\r\n    setVehicleModel(\"\");\r\n    setBrand(\"\");\r\n    setShowModel(false);\r\n    setNumberError(\"\");\r\n    setModelError(\"\");\r\n    setBrandError(\"\");\r\n    setVehicleData(null);\r\n    setShowSelectVehicle(false);\r\n    onClose();\r\n  };\r\n\r\n  const handleBack = () => {\r\n    setVehicleNumber(\"\");\r\n    setVehicleModel(\"\");\r\n    setBrand(\"\");\r\n    setShowModel(false);\r\n    setNumberError(\"\");\r\n    setModelError(\"\");\r\n    setBrandError(\"\");\r\n    setVehicleData(null);\r\n    setShowSelectVehicle(false);\r\n    onBack();\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Modal\r\n        isOpen={isOpen && !showSelectVehicle}\r\n        onClose={handleClose}\r\n        onBack={handleBack}\r\n      >\r\n        <div className=\"w-full max-w-[550px] flex flex-col items-center p-5\">\r\n          <div className=\"w-full flex items-center gap-3 bg-green-50 border border-green-200 text-[#6AAC5E] rounded-lg px-3 py-4 mb-4\">\r\n            <img src={verifyIcon} alt=\"verify\" className=\"w-5 h-5\" />\r\n            <span className=\"font-medium text-sm text-[#333333]\">\r\n              Account is Verified\r\n            </span>\r\n          </div>\r\n\r\n          <div className=\"bg-white rounded-xl p-6 w-full flex flex-col items-center mb-10\">\r\n            <h2 className=\"text-2xl font-semibold text-[#242424] mb-4 w-full text-left\">\r\n              Vehicle not listed?\r\n            </h2>\r\n\r\n            <label className=\"w-full text-xs text-[#333333] mb-1\">\r\n              Enter Vehicle Number\r\n            </label>\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"Enter Registration Number (e.g. MH12AB1234)\"\r\n              value={vehicleNumber}\r\n              onChange={(e) =>\r\n                setVehicleNumber(e.target.value.toUpperCase().replace(/\\s/g, \"\"))\r\n              }\r\n              className=\"w-full border border-[#BCD2F5] rounded-lg px-3 py-3 mb-3 text-xs bg-[#F8F8F8]\r\n              hover:border-[#BCD2F5] focus:outline-none focus:border-[#BCD2F5] focus:ring-2 focus:ring-[#BCD2F5]\"\r\n              maxLength={15}\r\n              disabled={isLoading}\r\n            />\r\n            {numberError && (\r\n              <div className=\"text-[#CB0200] text-xs mb-3 w-full\">{numberError}</div>\r\n            )}\r\n\r\n            {showModel && (\r\n              <>\r\n                <label className=\"w-full text-xs text-[#333333] mb-1\">Brand</label>\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"Enter Brand\"\r\n                  value={brand}\r\n                  onChange={(e) => {\r\n                    setBrand(e.target.value);\r\n                    setBrandError(\"\");\r\n                  }}\r\n                  className=\"w-full border border-[#BCD2F5] rounded-lg px-3 py-3 mb-3 text-xs bg-[#F8F8F8]\r\n                  hover:border-[#BCD2F5] focus:outline-none focus:border-[#BCD2F5] focus:ring-2 focus:ring-[#BCD2F5]\"\r\n                />\r\n                {brandError && (\r\n                  <div className=\"text-[#CB0200] text-xs mb-2 w-full\">{brandError}</div>\r\n                )}\r\n\r\n                <label className=\"w-full text-xs text-[#333333] mb-1\">Model</label>\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"Enter Model\"\r\n                  value={vehicleModel}\r\n                  onChange={(e) => {\r\n                    setVehicleModel(e.target.value);\r\n                    setModelError(\"\");\r\n                  }}\r\n                  className=\"w-full border border-[#BCD2F5] rounded-lg px-3 py-3 mb-3 text-xs bg-[#F8F8F8]\r\n                  hover:border-[#BCD2F5] focus:outline-none focus:border-[#BCD2F5] focus:ring-2 focus:ring-[#BCD2F5]\"\r\n                />\r\n                {modelError && (\r\n                  <div className=\"text-[#CB0200] text-xs mb-3 w-full\">{modelError}</div>\r\n                )}\r\n              </>\r\n            )}\r\n\r\n            <Button\r\n              text={\r\n                isLoading ? \"Searching...\" : showModel ? \"Add Vehicle\" : \"Search\"\r\n              }\r\n              onClick={showModel ? handleAddVehicle : handleSearch}\r\n              disabled={isLoading}\r\n              className=\"self-start w-1/2 bg-[#266DDF] text-white font-semibold py-3 rounded-lg hover:bg-blue-700 transition disabled:bg-gray-400\"\r\n            />\r\n          </div>\r\n        </div>\r\n      </Modal>\r\n\r\n      {showSelectVehicle && vehicleData && (\r\n        <Suspense\r\n          fallback={\r\n            <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\r\n              <div className=\"text-white\"></div>\r\n            </div>\r\n          }\r\n        >\r\n          <SelectVehicle\r\n            isOpen={showSelectVehicle}\r\n            onClose={handleClose}\r\n            onBack={() => setShowSelectVehicle(false)}\r\n            addedVehicleNumber={vehicleData.vehicleNumber}\r\n            addedVehicleBrand={vehicleData.brand}\r\n            addedVehicleModel={vehicleData.model}\r\n            plan={plan}\r\n          />\r\n        </Suspense>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default EnterVehicleNumber;\r\n"
        }
    ]
}