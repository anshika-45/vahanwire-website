{
    "sourceFile": "src/components/AddVehicleModal.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1763045434135,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763045528835,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -171,9 +171,9 @@\n   return (\n     <>\n       <Backdrop onClose={onClose} />\n       <div className=\"fixed inset-0 z-[9999] grid place-items-center p-3 sm:p-4\">\n-        <div className=\"w-full max-w-3xl rounded-2xl bg-white shadow-2xl border border-slate-200\">\n+        <div className=\"w-full max-w-3xl rounded-2xl bg-white shadow-2xl\">\n           {/* Header */}\n           <div className=\"flex justify-between items-center bg-[#D9E7FE] rounded-t-2xl px-4 sm:px-6 py-3 sm:py-4 border-b\">\n             <h2 className=\"font-semibold text-center flex-1 text-sm sm:text-base\">\n               Add New Vehicle\n@@ -191,9 +191,9 @@\n                 <button\n                   key={type}\n                   type=\"button\"\n                   onClick={() => setVehicleType(type)}\n-                  className={`relative flex flex-col items-center w-24 h-24 rounded-xl ${\n+                  className={`relative flex flex-col items-center w-28 h-24 rounded-xl ${\n                     vehicleType === type\n                       ? \"border-[#266DDF] bg-[#ECF3FD]\"\n                       : \"border border-transparent hover:bg-[#ECF3FD]\"\n                   }`}\n"
                }
            ],
            "date": 1763045434135,
            "name": "Commit-0",
            "content": "import React, { useEffect, useState } from \"react\";\nimport carColor from \"../assets/CarFill.svg\";\nimport carOutline from \"../assets/CarFade.svg\";\nimport bikeColor from \"../assets/BikeFill.svg\";\nimport bikeOutline from \"../assets/BikeFade.svg\";\nimport { addUserVehicle } from \"../api/vehicleApi\";\n\nconst Backdrop = ({ onClose }) => (\n  <div\n    className=\"fixed inset-0 bg-black/40 z-[9998]\"\n    onClick={onClose}\n    aria-hidden=\"true\"\n  />\n);\n\nconst AddVehicleModal = ({ open, onClose, onSubmit }) => {\n  const [vehicleType, setVehicleType] = useState(\"car\");\n  const [form, setForm] = useState({\n    vehicleNumber: \"\",\n    brand: \"\",\n    model: \"\",\n    year: \"\",\n    fuelType: \"\",\n  });\n  const [errors, setErrors] = useState({});\n  const [touched, setTouched] = useState({});\n  const [loading, setLoading] = useState(false);\n  const [submitError, setSubmitError] = useState(\"\");\n\n  useEffect(() => {\n    if (!open) return;\n    document.body.style.overflow = \"hidden\";\n    const onKey = (e) => e.key === \"Escape\" && onClose();\n    window.addEventListener(\"keydown\", onKey);\n    return () => {\n      document.body.style.overflow = \"auto\";\n      window.removeEventListener(\"keydown\", onKey);\n    };\n  }, [open, onClose]);\n\n  useEffect(() => {\n    if (!open) {\n      setForm({\n        vehicleNumber: \"\",\n        brand: \"\",\n        model: \"\",\n        year: \"\",\n        fuelType: \"\",\n      });\n      setErrors({});\n      setTouched({});\n      setSubmitError(\"\");\n      setVehicleType(\"car\");\n    }\n  }, [open]);\n\n  const validateField = (name, value) => {\n    switch (name) {\n      case \"vehicleNumber\": {\n        const clean = value.replace(/\\s/g, \"\").toUpperCase();\n        if (!clean) return \"Vehicle number is required\";\n        const regex = /^[A-Z]{2}[0-9]{1,2}[A-Z]{0,4}[0-9]{3,4}$/;\n        if (!regex.test(clean))\n          return \"Please enter a valid number (e.g., DL01AB1234)\";\n        if (clean.length < 8 || clean.length > 12)\n          return \"Vehicle number should be 8–12 characters\";\n        return \"\";\n      }\n      case \"brand\":\n        if (!value.trim()) return \"Brand is required\";\n        if (value.length < 2) return \"Brand must be at least 2 characters\";\n        return \"\";\n      case \"model\":\n        if (!value.trim()) return \"Model is required\";\n        return \"\";\n      case \"year\": {\n        if (!value.trim()) return \"Year is required\";\n        const yearNum = +value;\n        const curr = new Date().getFullYear();\n        if (yearNum < 1900 || yearNum > curr + 1)\n          return `Year must be between 1900 and ${curr + 1}`;\n        return \"\";\n      }\n      case \"fuelType\": {\n        if (!value.trim()) return \"Fuel type is required\";\n        const valid = [\"petrol\", \"diesel\", \"electric\", \"cng\", \"hybrid\", \"lpg\"];\n        if (!valid.includes(value.toLowerCase()))\n          return \"Invalid fuel type (try Petrol, Diesel, Electric, etc.)\";\n        return \"\";\n      }\n      default:\n        return \"\";\n    }\n  };\n\n  const validateForm = () => {\n    const newErrors = {};\n    for (const key of Object.keys(form)) {\n      newErrors[key] = validateField(key, form[key]);\n    }\n    setErrors(newErrors);\n    return !Object.values(newErrors).some((err) => err);\n  };\n\n  const handleChange = (e) => {\n    const { name, value } = e.target;\n    const newValue = name === \"vehicleNumber\" ? value.toUpperCase() : value;\n    setForm((prev) => ({ ...prev, [name]: newValue }));\n    if (touched[name]) {\n      setErrors((prev) => ({\n        ...prev,\n        [name]: validateField(name, newValue),\n      }));\n    }\n  };\n\n  const handleBlur = (e) => {\n    const { name, value } = e.target;\n    setTouched((prev) => ({ ...prev, [name]: true }));\n    setErrors((prev) => ({\n      ...prev,\n      [name]: validateField(name, value),\n    }));\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    setSubmitError(\"\");\n\n    const allTouched = Object.keys(form).reduce(\n      (acc, key) => ({ ...acc, [key]: true }),\n      {}\n    );\n    setTouched(allTouched);\n\n    if (!validateForm()) {\n      setSubmitError(\"Vehicle Data is invalid\");\n      return;\n    }\n\n    setLoading(true);\n\n    const payload = {\n      vehicleNumber: form.vehicleNumber.replace(/\\s/g, \"\"),\n      vehicleType,\n      brand: form.brand.trim(),\n      model: form.model.trim(),\n      fuelType: form.fuelType.trim().toUpperCase(),\n      year: form.year,\n    };\n\n    try {\n      const res = await addUserVehicle(payload);\n      console.log(\"add vehicle response\", res);\n      if (res?.success || res?.data?.success) {\n        alert(\"Vehicle added successfully!\");\n        onSubmit?.();\n        onClose();\n      } else {\n        setSubmitError(res?.data?.message || \"Failed to add vehicle\");\n      }\n    } catch (err) {\n      setSubmitError(\"An error occurred while adding the vehicle\");\n    }\n\n    setLoading(false);\n  };\n\n  if (!open) return null;\n\n  return (\n    <>\n      <Backdrop onClose={onClose} />\n      <div className=\"fixed inset-0 z-[9999] grid place-items-center p-3 sm:p-4\">\n        <div className=\"w-full max-w-3xl rounded-2xl bg-white shadow-2xl border border-slate-200\">\n          {/* Header */}\n          <div className=\"flex justify-between items-center bg-[#D9E7FE] rounded-t-2xl px-4 sm:px-6 py-3 sm:py-4 border-b\">\n            <h2 className=\"font-semibold text-center flex-1 text-sm sm:text-base\">\n              Add New Vehicle\n            </h2>\n            <button onClick={onClose} className=\"text-slate-600 text-lg\">\n              ✕\n            </button>\n          </div>\n\n          {/* Form */}\n          <form onSubmit={handleSubmit} className=\"p-4 sm:p-6 space-y-3 text-sm\">\n            {/* Vehicle type toggle */}\n            <div className=\"flex justify-center gap-4\">\n              {[\"car\", \"bike\"].map((type) => (\n                <button\n                  key={type}\n                  type=\"button\"\n                  onClick={() => setVehicleType(type)}\n                  className={`relative flex flex-col items-center w-24 h-24 rounded-xl ${\n                    vehicleType === type\n                      ? \"border-[#266DDF] bg-[#ECF3FD]\"\n                      : \"border border-transparent hover:bg-[#ECF3FD]\"\n                  }`}\n                >\n                  <span\n                    className={`absolute top-0 px-3 py-0.5 rounded-b-md text-[11px] font-semibold ${\n                      vehicleType === type\n                        ? \"bg-[#E2A701] text-white\"\n                        : \"bg-[#FFF8E6] text-black\"\n                    }`}\n                  >\n                    {type === \"car\" ? \"Car\" : \"Bike\"}\n                  </span>\n                  <img\n                    src={\n                      type === \"car\"\n                        ? vehicleType === \"car\"\n                          ? carColor\n                          : carOutline\n                        : vehicleType === \"bike\"\n                        ? bikeColor\n                        : bikeOutline\n                    }\n                    alt={type}\n                    className=\"h-7 mt-8\"\n                  />\n                </button>\n              ))}\n            </div>\n\n            {/* Form Inputs */}\n            {[\"vehicleNumber\", \"year\", \"fuelType\", \"brand\", \"model\"].map(\n              (field) => (\n                <div key={field}>\n                  <label className=\"block text-slate-700 mb-1 capitalize\">\n                    {field === \"vehicleNumber\"\n                      ? \"Vehicle Number\"\n                      : field === \"fuelType\"\n                      ? \"Fuel Type\"\n                      : field}\n                  </label>\n                  <input\n                    name={field}\n                    value={form[field]}\n                    onChange={handleChange}\n                    onBlur={handleBlur}\n                    className={`w-full border rounded-lg px-3 py-1.5 text-sm focus:ring-2 focus:ring-[#D9E7FE] outline-none ${\n                      errors[field] && touched[field]\n                        ? \"border-red-500 bg-red-50\"\n                        : \"border-slate-300\"\n                    }`}\n                    placeholder={`Enter ${field}`}\n                  />\n                  {errors[field] && touched[field] && (\n                    <p className=\"text-red-600 text-xs mt-1\">\n                      {errors[field]}\n                    </p>\n                  )}\n                </div>\n              )\n            )}\n\n            {submitError && (\n              <p className=\"text-red-600 text-xs text-center bg-red-50 py-2 rounded-lg\">\n                {submitError}\n              </p>\n            )}\n\n            <div className=\"flex gap-2 pt-2\">\n              <button\n                type=\"button\"\n                onClick={onClose}\n                disabled={loading}\n                className=\"border-2 border-blue-600 px-6 py-2 rounded-lg text-[#266DDF] hover:bg-blue-700 hover:text-white transition disabled:opacity-50\"\n              >\n                Cancel\n              </button>\n              <button\n                type=\"submit\"\n                disabled={loading}\n                className=\"border-2 border-blue-600 px-6 py-2 rounded-lg text-[#266DDF] hover:bg-blue-700 hover:text-white transition disabled:opacity-60\"\n              >\n                {loading ? \"Adding...\" : \"Add Vehicle\"}\n              </button>\n            </div>\n          </form>\n        </div>\n      </div>\n    </>\n  );\n};\n\nexport default AddVehicleModal;\n"
        }
    ]
}