{
    "sourceFile": "src/components/EditVehicleModal2.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1763043212936,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763045541688,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -253,9 +253,9 @@\n         onClick={onClose}\n         aria-hidden=\"true\"\n       />\n       <div className=\"fixed inset-0 z-[9999] grid place-items-center p-2 sm:p-4\">\n-        <div className=\"w-full max-w-2xl rounded-2xl bg-white shadow-2xl border border-slate-200\">\n+        <div className=\"w-full max-w-2xl rounded-2xl bg-white shadow-2xl\">\n           <div className=\"flex items-center justify-between px-4 sm:px-6 py-3 sm:py-4 border-b border-slate-200 bg-[#D9E7FE] rounded-t-2xl\">\n             <h2 className=\"text-sm sm:text-base font-semibold text-slate-800 flex-1 text-center\">\n               Edit Vehicle Details\n             </h2>\n"
                }
            ],
            "date": 1763043212936,
            "name": "Commit-0",
            "content": "import React, { useEffect, useState } from \"react\";\n// image imports (adjust paths if your assets live elsewhere)\nimport carColor from \"../assets/CarFill.svg\";\nimport carOutline from \"../assets/CarFade.svg\";\nimport bikeColor from \"../assets/BikeFill.svg\";\nimport bikeOutline from \"../assets/BikeFade.svg\";\n\nexport default function EditVehicleModal2({\n  open,\n  onClose = () => {},\n  onSubmit = () => {},\n  initial = null,\n  initialVehicleType = null,\n}) {\n  const [vehicleType, setVehicleType] = useState(\"car\");\n  const [form, setForm] = useState({\n    vehicleNumber: \"\",\n    brand: \"\",\n    model: \"\",\n  });\n  const [errors, setErrors] = useState({});\n  const [touched, setTouched] = useState({});\n  const [submitError, setSubmitError] = useState(\"\");\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  useEffect(() => {\n    if (!open) return;\n    document.body.style.overflow = \"hidden\";\n    return () => {\n      document.body.style.overflow = \"auto\";\n    };\n  }, [open]);\n\n  // infer vehicle type from various sources\n  const inferVehicleType = () => {\n    // precedence: initialVehicleType prop -> initial.vehicleType -> initial.vehicleInfo -> initial.vehicle (text) -> default car\n    const pref =\n      initialVehicleType ||\n      (initial && initial.vehicleType) ||\n      (initial && initial.vehicleInfo) ||\n      (initial && initial.vehicle) ||\n      \"\";\n    if (!pref) return \"car\";\n    const p = String(pref).toLowerCase();\n    if (\n      p.includes(\"bike\") ||\n      p.includes(\"motor\") ||\n      p.includes(\"two\") ||\n      p.includes(\"scooter\") ||\n      p.includes(\"motorcycle\")\n    )\n      return \"bike\";\n    if (\n      p.includes(\"car\") ||\n      p.includes(\"auto\") ||\n      p.includes(\"four\") ||\n      p.includes(\"sedan\") ||\n      p.includes(\"hatch\")\n    )\n      return \"car\";\n    // fallback to car\n    return \"car\";\n  };\n\n  useEffect(() => {\n    const inferred = inferVehicleType();\n    setVehicleType(inferred);\n\n    if (initial) {\n      setForm({\n        vehicleNumber: initial.vehicleNumber || initial.vehicle || \"\",\n        brand: initial.brand || initial.vehicleBrand || \"\",\n        model: initial.model || initial.vehicleModel || \"\",\n      });\n    } else {\n      setForm({\n        vehicleNumber: \"\",\n        brand: \"\",\n        model: \"\",\n      });\n    }\n\n    setErrors({});\n    setTouched({});\n    setSubmitError(\"\");\n    setIsSubmitting(false);\n  }, [initial, initialVehicleType, open]);\n\n  const isEditMode = !!(initial || initialVehicleType);\n\n  const formatVehicleNumber = (value) =>\n    String(value || \"\")\n      .replace(/\\s/g, \"\")\n      .toUpperCase();\n\n  const validateField = (name, value) => {\n    const v = String(value || \"\").trim();\n    switch (name) {\n      case \"vehicleNumber\": {\n        if (!v) return \"Vehicle number is required\";\n        const clean = formatVehicleNumber(v);\n        const vehicleNumberRegex = /^[A-Z]{2}[0-9]{1,2}[A-Z]{0,4}[0-9]{1,4}$/;\n        if (!vehicleNumberRegex.test(clean))\n          return \"Vehicle number format: State code (2) + Digits (1-2) + Letters (0-4) + Digits (1-4)\";\n        if (clean.length < 6 || clean.length > 12)\n          return \"Vehicle number should be between 6-12 characters\";\n        return \"\";\n      }\n      case \"brand\": {\n        if (!v) return \"Brand is required\";\n        if (v.length < 2) return \"Brand name must be at least 2 characters\";\n        if (!/^[A-Za-z0-9\\s&.\\-]{2,}$/.test(v))\n          return \"Brand can contain letters, numbers, &, ., -\";\n        if (v.length > 50) return \"Brand name cannot exceed 50 characters\";\n        return \"\";\n      }\n      case \"model\": {\n        if (!v) return \"Model is required\";\n        if (v.length < 1) return \"Model cannot be empty\";\n        if (!/^[A-Za-z0-9\\s&.\\-]{1,}$/.test(v))\n          return \"Model can contain letters, numbers, &, ., -\";\n        if (v.length > 50) return \"Model name cannot exceed 50 characters\";\n        return \"\";\n      }\n      // case \"year\": {\n      //   if (!v) return \"Manufacture year is required\";\n      //   if (!/^\\d{4}$/.test(v)) return \"Year must be in YYYY format (e.g., 2023)\";\n      //   const yearNum = parseInt(v, 10);\n      //   const currentYear = new Date().getFullYear();\n      //   if (yearNum < 1900 || yearNum > currentYear + 1)\n      //     return `Year must be between 1900 and ${currentYear + 1}`;\n      //   return \"\";\n      // }\n      // case \"fuelType\": {\n      //   if (!v) return \"Fuel type is required\";\n      //   const allowed = [\n      //     \"petrol\",\n      //     \"diesel\",\n      //     \"electric\",\n      //     \"cng\",\n      //     \"hybrid\",\n      //     \"lpg\",\n      //     \"ev\",\n      //   ];\n      //   if (!allowed.includes(v.toLowerCase()))\n      //     return \"Valid fuel types: Petrol, Diesel, Electric, CNG, Hybrid, LPG, EV\";\n      //   return \"\";\n      // }\n      default:\n        return \"\";\n    }\n  };\n\n  const validateForm = () => {\n    const newErrors = {};\n    Object.keys(form).forEach((k) => {\n      newErrors[k] = validateField(k, form[k]);\n    });\n    setErrors(newErrors);\n    return !Object.values(newErrors).some(Boolean);\n  };\n\n  const handleChange = (e) => {\n    const { name, value } = e.target;\n    \n    // Reject invalid characters for specific fields\n    let processed = value;\n    \n    if (name === \"vehicleNumber\") {\n      processed = formatVehicleNumber(value);\n    } else if (name === \"year\") {\n      // Only allow digits\n      processed = value.replace(/\\D/g, \"\");\n      if (processed.length > 4) processed = processed.slice(0, 4);\n    } else if (name === \"brand\" || name === \"model\") {\n      // Only allow alphanumeric, spaces, &, ., -\n      processed = value.replace(/[^a-zA-Z0-9\\s&.\\-]/g, \"\");\n    } else if (name === \"fuelType\") {\n      // Only allow letters and spaces\n      processed = value.replace(/[^a-zA-Z\\s]/g, \"\");\n    }\n    \n    setForm((p) => ({ ...p, [name]: processed }));\n    setSubmitError(\"\");\n    \n    if (touched[name])\n      setErrors((p) => ({ ...p, [name]: validateField(name, processed) }));\n  };\n\n  const handleBlur = (e) => {\n    const { name, value } = e.target;\n    setTouched((p) => ({ ...p, [name]: true }));\n    const processed =\n      name === \"vehicleNumber\" ? formatVehicleNumber(value) : value;\n    setForm((p) => ({ ...p, [name]: processed }));\n    setErrors((p) => ({ ...p, [name]: validateField(name, processed) }));\n  };\n\n  const hasValidationErrors = () => {\n    return Object.keys(form).some(\n      (field) => touched[field] && errors[field]\n    );\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    setSubmitError(\"\");\n\n    const allTouched = Object.keys(form).reduce(\n      (acc, k) => ({ ...acc, [k]: true }),\n      {}\n    );\n    setTouched(allTouched);\n\n    if (!validateForm()) {\n      setSubmitError(\"Please fix all validation errors\");\n      return;\n    }\n\n    setIsSubmitting(true);\n    try {\n      const payload = {\n        vehicleNumber: formatVehicleNumber(form.vehicleNumber),\n        vehicleType,\n        brand: form.brand.trim(),\n        model: form.model.trim(),\n      };\n      \n      await onSubmit(payload);\n      onClose();\n    } catch (error) {\n      setSubmitError(\n        error?.message || \"Failed to update vehicle. Please try again.\"\n      );\n      setIsSubmitting(false);\n    }\n  };\n\n  if (!open) return null;\n\n  // show colored image for selected type, outline for the other if you ever toggle\n  const carSrc = vehicleType === \"car\" ? carColor : carOutline;\n  const bikeSrc = vehicleType === \"bike\" ? bikeColor : bikeOutline;\n\n  // Only show one image (the inferred/selected vehicle). Clicking it toggles between types (optional).\n  const displayedSrc = vehicleType === \"car\" ? carSrc : bikeSrc;\n  const displayedAlt = vehicleType === \"car\" ? \"Car\" : \"Bike\";\n\n  return (\n    <>\n      <div\n        className=\"fixed inset-0 bg-black/40 z-[9998]\"\n        onClick={onClose}\n        aria-hidden=\"true\"\n      />\n      <div className=\"fixed inset-0 z-[9999] grid place-items-center p-2 sm:p-4\">\n        <div className=\"w-full max-w-2xl rounded-2xl bg-white shadow-2xl border border-slate-200\">\n          <div className=\"flex items-center justify-between px-4 sm:px-6 py-3 sm:py-4 border-b border-slate-200 bg-[#D9E7FE] rounded-t-2xl\">\n            <h2 className=\"text-sm sm:text-base font-semibold text-slate-800 flex-1 text-center\">\n              Edit Vehicle Details\n            </h2>\n            <button\n              aria-label=\"Close\"\n              onClick={onClose}\n              className=\"text-slate-500 hover:text-slate-700 text-lg sm:text-xl flex-shrink-0\"\n            >\n              âœ•\n            </button>\n          </div>\n\n          <div className=\"p-4 sm:p-6\">\n            <div\n              className=\"relative w-36 sm:w-35 md:w-40 mx-auto rounded-lg overflow-hidden border border-blue-300\"\n              style={{ backgroundColor: \"#E8F4FF\", marginBottom: \"1rem\" }}\n            >\n              <div\n                className=\"absolute top-0 px-3 py-0.5 rounded-b-[8px] text-[11px] font-semibold left-1/2 -translate-x-1/2\"\n                style={{ backgroundColor: \"#FFD84D\" }}\n              >\n                {vehicleType === \"car\" ? \"Car\" : \"Bike\"}\n              </div>\n\n              <div className=\"flex justify-center pt-8\">\n                <img\n                  src={displayedSrc}\n                  alt={displayedAlt}\n                  loading=\"lazy\"\n                  className={`w-28 sm:w-30 md:w-35 object-contain ${\n                    !isEditMode ? \"cursor-pointer\" : \"\"\n                  }`}\n                  onClick={() =>\n                    !isEditMode &&\n                    setVehicleType((v) => (v === \"car\" ? \"bike\" : \"car\"))\n                  }\n                />\n              </div>\n            </div>\n\n            <form\n              onSubmit={handleSubmit}\n              className=\"space-y-3 text-xs sm:text-sm\"\n            >\n              <div>\n                <label className=\"block text-slate-700 mb-1 text-xs sm:text-sm\">\n                  Enter Vehicle Number\n                </label>\n                <input\n                  name=\"vehicleNumber\"\n                  value={form.vehicleNumber}\n                  onChange={handleChange}\n                  onBlur={handleBlur}\n                  className={`w-full h-8 sm:h-9 border rounded-lg px-3 text-xs sm:text-sm focus:ring-2 focus:ring-[#D9E7FE] outline-none ${\n                    errors.vehicleNumber && touched.vehicleNumber\n                      ? \"border-red-500 bg-red-50\"\n                      : \"border-slate-300\"\n                  }`}\n                  placeholder=\"Enter Vehicle Number\"\n                  maxLength={15}\n                />\n                {errors.vehicleNumber && touched.vehicleNumber && (\n                  <p className=\"text-red-600 text-xs mt-1\">\n                    {errors.vehicleNumber}\n                  </p>\n                )}\n              </div>\n\n              <div className=\"flex items-center gap-4 py-1\">\n                <div className=\"flex-1 border-t border-slate-300\" />\n                <span className=\"text-slate-500 text-xs\">OR</span>\n                <div className=\"flex-1 border-t border-slate-300\" />\n              </div>\n\n            \n\n              <div>\n                <label className=\"block text-slate-700 mb-1 text-xs sm:text-sm\">\n                  Select Brand\n                </label>\n                <input\n                  name=\"brand\"\n                  value={form.brand}\n                  onChange={handleChange}\n                  onBlur={handleBlur}\n                  className={`w-full h-8 sm:h-9 border rounded-lg px-3 text-xs sm:text-sm focus:ring-2 focus:ring-[#D9E7FE] outline-none ${\n                    errors.brand && touched.brand\n                      ? \"border-red-500 bg-red-50\"\n                      : \"border-slate-300\"\n                  }`}\n                  placeholder=\"Enter Brand\"\n                />\n                {errors.brand && touched.brand && (\n                  <p className=\"text-red-600 text-xs mt-1\">{errors.brand}</p>\n                )}\n              </div>\n\n              <div>\n                <label className=\"block text-slate-700 mb-1 text-xs sm:text-sm\">\n                  Select Model\n                </label>\n                <input\n                  name=\"model\"\n                  value={form.model}\n                  onChange={handleChange}\n                  onBlur={handleBlur}\n                  className={`w-full h-8 sm:h-9 border rounded-lg px-3 text-xs sm:text-sm focus:ring-2 focus:ring-[#D9E7FE] outline-none ${\n                    errors.model && touched.model\n                      ? \"border-red-500 bg-red-50\"\n                      : \"border-slate-300\"\n                  }`}\n                  placeholder=\"Enter Model\"\n                />\n                {errors.model && touched.model && (\n                  <p className=\"text-red-600 text-xs mt-1\">{errors.model}</p>\n                )}\n              </div>\n\n              {submitError && (\n                <div className=\"bg-red-50 border border-red-300 rounded-lg px-3 py-2 text-red-700 text-xs sm:text-sm\">\n                  {submitError}\n                </div>\n              )}\n\n              <div className=\"flex flex-col sm:flex-row justify-start gap-2 pt-2 sm:pt-3\">\n                <button\n                  type=\"button\"\n                  onClick={onClose}\n                  disabled={isSubmitting}\n                  className=\"py-2 px-6 sm:px-8 rounded-lg border-2 border-blue-600 text-[#266DDF] font-semibold hover:bg-blue-700 hover:text-white transition w-full sm:w-auto whitespace-nowrap disabled:opacity-60 disabled:cursor-not-allowed\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  disabled={isSubmitting || hasValidationErrors()}\n                  className=\"px-6 sm:px-8 py-2 rounded-lg border-2 border-blue-600 text-[#266DDF] font-semibold hover:bg-blue-700 hover:text-white transition w-full sm:w-auto whitespace-nowrap disabled:opacity-60 disabled:cursor-not-allowed\"\n                >\n                  {isSubmitting ? \"Saving...\" : \"Save\"}\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      </div>\n    </>\n  );\n}\n"
        }
    ]
}